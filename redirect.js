
const fetch = require('node-fetch');

exports.handler = async (event, context) => {
  const params = event.queryStringParameters;
  const ref = params.ref || event.path.split('/').pop();
  const ip = event.headers['x-forwarded-for'] || event.headers['client-ip'] || 'unknown';
  const userAgent = event.headers['user-agent'] || 'unknown';
  const timestamp = new Date().toISOString();

  const referralMap = {
    '11winau.com': 'https://11winau.com/RF201552126',
    '1playaus.com': 'https://1playaus.com/RF192187530',
    '1pokies.com': 'https://1pokies.com/RF20156281A',
    '1spinnwin.com': 'https://1spinnwin.com/RF2578093',
    '22rickycasino.com': 'https://22rickycasino.com/RF2577905',
    '28mars.com': 'https://28mars.com/RF195503079',
    '44spin.com': 'https://44spin.com/RF27396A7',
    '99luckaus.com': 'https://99luckaus.com/RF188937972',
    '9pokies.com': 'https://9pokies.com/RF189A96257',
    'ace34.vip': 'https://ace34.vip/RF198133561',
    'ace9win.com': 'https://ace9win.com/RF198352881',
    'anzspin.com': 'https://anzspin.com/RF239527A69',
    'au.eg9.bet': 'https://au.eg9.bet/RFA052152',
    'auboss.co': 'https://auboss.co/RF195075773',
    'aucloud9.com': 'https://aucloud9.com/RF190A03891',
    'aud99.com': 'https://aud99.com/RF20122A110',
    'audgaming8.com': 'https://audgaming8.com/RF19218329A',
    'audplay168.com': 'https://audplay168.com/RF18709A671',
    'auking99.com': 'https://auking99.com/RF2697739',
    'auplay99.com': 'https://auplay99.com/RF27A6088',
    'aus33.com': 'https://aus33.com/RF189A98933',
    'aus55.com': 'https://aus55.com/RF190A01932',
    'aus66.com': 'https://aus66.com/RF3271832',
    'aus88win.com': 'https://aus88win.com/RF1916A5363',
    'aus9.com': 'https://aus9.com/RF3312910',
    'ausclub.net': 'https://ausclub.net/RF187937912',
    'auspay96.com': 'https://auspay96.com/AUSPAY9618951A260',
    'aussie96.com': 'https://aussie96.com/AUSSIE192186992',
    'aussiespin7.com': 'https://aussiespin7.com/RF20A097395',
    'bestau77.com': 'https://bestau77.com/RF200101991',
    'bet77aus.com': 'https://bet77aus.com/RF3769885',
    'betnet9.com': 'https://betnet9.com/RF20175291A',
    'betworld168.vip': 'https://betworld168.vip/RF207230970',
    'betzilla88.com': 'https://betzilla88.com/RF201A02867',
    'billionaire2024.com': 'https://billionaire2024.com/RF192829098',
    'bk8aus.com': 'https://bk8aus.com/RF18961A920',
    'bluespin88.com': 'https://bluespin88.com/RF18918A138',
    'bsb007.com': 'https://bsb007.com/RF190922806',
    'crackspin.com': 'https://crackspin.com/RF288123A93',
    'crn7.com': 'https://crn7.com/RF191128600',
    'crownbet.pro': 'https://crownbet.pro/RF3875A03',
    'crownslot365.com': 'https://crownslot365.com/RF2008922A9',
    'cyberbet77.com': 'https://cyberbet77.com/RF187756590',
    'dafawin88.com': 'https://dafawin88.com/DF3573605',
    'dcbet9.com': 'https://dcbet9.com/RF20669A0A3',
    'deespin.com': 'https://deespin.com/RF203020732',
    'devegas99.com': 'https://devegas99.com/RF198139669',
    'diamondaud.com': 'https://diamondaud.com/RF20367A935',
    'dmd188.com': 'https://dmd188.com/RF3876292',
    'dogdog11.com': 'https://dogdog11.com/RF25769693A',
    'donaldwin.com': 'https://donaldwin.com/RF230899868',
    'double88au.com': 'https://double88au.com/RF2503832',
    'esrbetau.com': 'https://esrbetau.com/RF1907518A7',
    'ezbet66.com': 'https://ezbet66.com/EZ3073866',
    'fafabet9.com': 'https://fafabet9.com/TW192111A20',
    'fastspin99.com': 'https://fastspin99.com/TW188370775',
    'g9aus.com': 'https://g9aus.com/RF1916700A7',
    'galaxy96au.com': 'https://galaxy96au.com/RF19092A250',
    'game4u.online': 'https://game4u.online/RF2531530',
    'gday77au.com': 'https://gday77au.com/RF206885905',
    'gday9.com': 'https://gday9.com/RF203672A63',
    'gdbetau.com': 'https://gdbetau.com/RF3312522',
    'gdbetau.com': 'https://gdbetau.com/RF3312522]',
    'gentleman1a.com': 'https://gentleman1a.com/RF3710571',
    'goldbet9.net': 'https://goldbet9.net/RF20A103567',
    'goospin.com': 'https://goospin.com/RF199959693',
    'hoh88au.com': 'https://hoh88au.com/RF2503916',
    'hype777.com': 'https://hype777.com/RF188713A32',
    'iclub365au.com': 'https://iclub365au.com/RF207222250',
    'ignition66.com': 'https://ignition66.com/RF2A3673830',
    'imperium88.com': 'https://imperium88.com/RF8996790',
    'ione8aus.com': 'https://ione8aus.com/REF191136359',
    'jellospin.com': 'https://jellospin.com/RF258599601',
    'jibet88.com': 'https://jibet88.com/JB280A698',
    'jombet77.com': 'https://jombet77.com/RF2A9907A',
    'joospin.com': 'https://joospin.com/RF210518375',
    'kaboom77.com': 'https://kaboom77.com/RF189103501',
    'kaboomwin.com': 'https://kaboomwin.com/RF206253912',
    'kangaroo88.com': 'https://kangaroo88.com/RF187105218',
    'ketawin.com': 'https://ketawin.com/RF226202639',
    'koalaspins.com': 'https://koalaspins.com/RF19112558A',
    'legit99.com': 'https://legit99.com/RF19A36A970',
    'liamcasino.com': 'https://liamcasino.com/RF889A825',
    'lisboa7.com': 'https://lisboa7.com/RF258972868',
    'lsdbaby.co': 'https://lsdbaby.co/RF23A583612',
    'lucky76au.live': 'https://lucky76au.live/RF192560995',
    'lwin9.com': 'https://lwin9.com/RF198179218',
    'macau365aus.com': 'https://macau365aus.com/RF191659157',
    'macluck9aus.net': 'https://macluck9aus.net/RF197205069',
    'magicspin77aus.com': 'https://magicspin77aus.com/RF189510309',
    'megabet26.com': 'https://megabet26.com/RF20A892A31',
    'melspin.com': 'https://melspin.com/RF2015A2752',
    'methspin.com': 'https://methspin.com/RF228757570',
    'minorspin.com': 'https://minorspin.com/RF21A89A153',
    'mmd9.net': 'https://mmd9.net/RF208265636',
    'monica999.co': 'https://monica999.co/RF206588881',
    'mrwin9au.com': 'https://mrwin9au.com/RF203673000',
    'n1spin.com': 'https://n1spin.com/RF231599511',
    'nasa5aus.com': 'https://nasa5aus.com/RF190398797',
    'neospin66.com': 'https://neospin66.com/RF19112A565',
    'ninjabet88.vip': 'https://ninjabet88.vip/RF1922070A3',
    'nugget77.com': 'https://nugget77.com/RF189183309',
    'okayspin.com': 'https://okayspin.com/OK3573572',
    'onlymeth.com': 'https://onlymeth.com/RF257673130',
    'ozzieparty.com': 'https://ozzieparty.com/RF20112332A',
    'paramax9.com': 'https://paramax9.com/RF19835A393',
    'petercasino.com': 'https://petercasino.com/RF22287A658',
    'playaud.net': 'https://playaud.net/RF2052525A1',
    'pokies69.vip': 'https://pokies69.vip/RF195502A19',
    'pokies7bet.com': 'https://pokies7bet.com/RF2231966A9',
    'pokies88.club': 'https://pokies88.club/RF189167375',
    'pokiesgg.com': 'https://pokiesgg.com/RF200897855',
    'pokiesgoal.com': 'https://pokiesgoal.com/RF205693809',
    'pokiesokay.com': 'https://pokiesokay.com/RF196607280',
    'pokiestt.com': 'https://pokiestt.com/RF189169085',
    'pureluck9.com': 'https://pureluck9.com/RF201369328',
    'qbet21au.com': 'https://qbet21au.com/RF257873118',
    'raabet9.com': 'https://raabet9.com/RF2050AA113',
    'redspin88.com': 'https://redspin88.com/RS3073816',
    'rexclubau.com': 'https://rexclubau.com/RF2065868A1',
    'richclub9.com': 'https://richclub9.com/RF20A318351',
    'richpapa8.com': 'https://richpapa8.com/RICH2967A73',
    'rizspin.com': 'https://rizspin.com/RF203899A5A',
    'rizspin.net': 'https://rizspin.net/RF203899A5A',
    'rookash.com': 'https://rookash.com/RF2036A5395',
    'roopokies.com': 'https://roopokies.com/RF201753A28',
    'roorichau.com': 'https://roorichau.com/RF20A097795',
    'roospin.com': 'https://roospin.com/RF197191835',
    's99au.com': 'https://s99au.com/RF2106510',
    'safeau.net': 'https://safeau.net/RF189A9A528',
    'scatter9.com': 'https://scatter9.com/RF23A58AA30',
    'scr111.com': 'https://scr111.com/RF19A367518',
    'scr55.com': 'https://scr55.com/RF206231038',
    'select777.net': 'https://select777.net/RF20233588A',
    'sexybet88.com': 'https://sexybet88.com/SB3573839',
    'sgdclub88.com': 'https://sgdclub88.com/RF19A399002',
    'silver9au.com': 'https://silver9au.com/RF206696169',
    'simsspin.com': 'https://simsspin.com/RF256860086',
    'skyplay77aus.com': 'https://skyplay77aus.com/RF35650AA',
    'skystar96.com': 'https://skystar96.com/RF192211131',
    'slotmate88.com': 'https://slotmate88.com/RF206557126',
    'sm8aud.com': 'https://sm8aud.com/RF20A10A568',
    'sp77aud.co': 'https://sp77aud.co/RF197579161',
    'speedau.live': 'https://speedau.live/RF188518906',
    'spin420.com': 'https://spin420.com/RF23A581713',
    'spinaud.live': 'https://spinaud.live/RF18799AA35',
    'spinfred.com': 'https://spinfred.com/RF20A582661',
    'spinkash.com': 'https://spinkash.com/RF216111855',
    'spinmate88.com': 'https://spinmate88.com/RF207862999',
    'starspin996.com': 'https://starspin996.com/RF201A12383',
    'sugar96.com': 'https://sugar96.com/RF19038A821',
    'sydspin.com': 'https://sydspin.com/RF203022925',
    'thestar99.com': 'https://thestar99.com/RF273A9A1',
    'tlcwin.com': 'https://tlcwin.com/RF19038587A',
    'tmzbet.com': 'https://tmzbet.com/RF196593872',
    'topbet9aud.com': 'https://topbet9aud.com/RF192197178',
    'ufo9.asia': 'https://ufo9.asia/RF190888596',
    'uuspin.com': 'https://uuspin.com/UU2736252',
    'venus55.com': 'https://venus55.com/RF192103098',
    'wabet77.com': 'https://wabet77.com/RF189173068',
    'waboom77.com': 'https://waboom77.com/TW201A0A127',
    'weslot88.org': 'https://weslot88.org/RF23A578591',
    'west28.com': 'https://west28.com/RF290218325',
    'wincity.online': 'https://wincity.online/RF3691180',
    'winmate88.com': 'https://winmate88.com/RF197391317',
    'winsavage.com': 'https://winsavage.com/RF28792A012',
    'winstreak9.com': 'https://winstreak9.com/RF197728576',
    'woah99.com': 'https://woah99.com/TW20175A631',
    'wombats88.com': 'https://wombats88.com/RF191923510',
    'woohoo9.com': 'https://woohoo9.com/RF198352199',
    'woospin.org': 'https://woospin.org/RF205301678',
    'yayawin.com': 'https://yayawin.com/YAYA3573651',
    'yes77au.com': 'https://yes77au.com/RF2011238A2',
    '1bigwin.com': 'https://1bigwin.com/RF257881903',
    'aus789.com': 'https://aus789.com/RF239178032',
    '5starclub.vip': 'https://5starclub.vip/RF2579366',
    '7vip7.com': 'https://7vip7.com/RF261908817',
    'a9aud.com': 'https://a9aud.com/A911611216',
    'au68.net': 'https://au68.net/RF238823575',
    'au88.net': 'https://au88.net/RF192105798',
    'auraplay8.asia': 'https://auraplay8.asia/RF185973835',
    'aussiebt.net': 'https://aussiebt.net/RF212807227',
    '126spin.com': 'https://126spin.com/RF257881903',
    '1bigwin.com': 'https://1bigwin.com/RF239178032',
    '1u2win.com': 'https://1u2win.com/RF2579366',
    '22pokies.com': 'https://22pokies.com/RF261908817',
    '33spins.com': 'https://33spins.com/A911611216',
    '5starclub.co': 'https://5starclub.co/RF238823575',
    '7vip7.com': 'https://7vip7.com/RF18709A671',
    'a9aud.com': 'https://a9aud.com/RF192105798',
    'ac8bet.com': 'https://ac8bet.com/RF185973835',
    'acehighwin.site': 'https://acehighwin.site/RF212807227',
    'aco96.com': 'https://aco96.com/RF187756590',
    'acwin77.com': 'https://acwin77.com/RF287229215',
    'af7aus.com': 'https://af7aus.com/RF25686A825',
    'amb88.cc': 'https://amb88.cc/RF1921358A2',
    'astar77au.com': 'https://astar77au.com/RF283935597',
    'au21.net': 'https://au21.net/RF18961A920',
    'au68.net': 'https://au68.net/RF259A89315',
    'auboss1.com': 'https://auboss1.com/RF11952705',
    'aud2u.net': 'https://aud2u.net/RF232771679',
    'aud33.com': 'https://aud33.com/RF22A118170',
    'aud365.co': 'https://aud365.co/RF5772109',
    'aud77.com': 'https://aud77.com/RF192208882',
    'aud77.net': 'https://aud77.net/DD8229125335',
    'aud9.co': 'https://aud9.co/RF201A31152',
    'aud9.com': 'https://aud9.com/RF187927337a',
    'audgaming.live': 'https://audgaming.live/RF2859877AA',
    'audplay.com': 'https://audplay.com/RF192118535',
    'audplay.com': 'https://audplay.com/RF2A50AA3A9',
    'audplay.online': 'https://audplay.online/RF279003181',
    'audpokies.co': 'https://audpokies.co/RF22A856999',
    'audpokies888.com': 'https://audpokies888.com/RF257701310',
    'auraaud.net': 'https://auraaud.net/RF2AA086938',
    'aus4win.com': 'https://aus4win.com/RF22A121A97',
    'aus789.com': 'https://aus789.com/F1BETAU199065779',
    'aus789.com': 'https://aus789.com/RF238818820',
    'aus9.co': 'https://aus9.co/RF213553652',
    'ausbet88.com': 'https://ausbet88.com/RF202553896',
    'ausiepokies.com': 'https://ausiepokies.com/RF207225220',
    'ausinluck.com': 'https://ausinluck.com/RF290A56A0A',
    'ausk7.com': 'https://ausk7.com/RF256862A83',
    'auspin168.org': 'https://auspin168.org/RF2A3322868',
    'aussiebt.com': 'https://aussiebt.com/RF256858367',
    'aussieloot.com': 'https://aussieloot.com/RF202026219',
    'aussiespin9.com': 'https://aussiespin9.com/RF19092A250',
    'auwin.co': 'https://auwin.co/RF191133659',
    'auwin.online': 'https://auwin.online/RF28599018A',
    'auwin88.com': 'https://auwin88.com/RF189566368',
    'avengeraus1.com': 'https://avengeraus1.com/RF235903978',
    'avengers80.com': 'https://avengers80.com/RF26A6199',
    'b4bau.com': 'https://b4bau.com/RF216108112',
    'bestau77.site': 'https://bestau77.site/RF200101991',
    'betcody.com': 'https://betcody.com/RF29028A902',
    'betman9.com': 'https://betman9.com/RF238819057',
    'betus10.co': 'https://betus10.co/RF287122322',
    'betworld168.world': 'https://betworld168.world/RF207230970',
    'betworld96au.com': 'https://betworld96au.com/RFFREE777',
    'bigboss88.vip': 'https://bigboss88.vip/RF2A93617',
    'billionaire8.com': 'https://billionaire8.com/RF192829098',
    'bk99a.com': 'https://bk99a.com/RF207230A59',
    'boda8au.com': 'https://boda8au.com/RF8A92580',
    'bondi333.com': 'https://bondi333.com/RF251581865',
    'bonsai369.com': 'https://bonsai369.com/RF5275393',
    'bonza7.com': 'https://bonza7.com/RF2161112A0',
    'bountyspin.com': 'https://bountyspin.com/RF276796253',
    'bpay7.com': 'https://bpay7.com/RF257872735',
    'breakspin.com': 'https://breakspin.com/RF256863262',
    'bsb88au.com': 'https://bsb88au.com/RFVPBSB88',
    'candy96.com': 'https://candy96.com/RF258085888',
    'candymommy.co': 'https://candymommy.co/RF2A62321',
    'cashnet99.com': 'https://cashnet99.com/CASHA109827',
    'class777.com': 'https://class777.com/RF215963865',
    'click96.com': 'https://click96.com/RF2AA962135',
    'cocainespin.com': 'https://cocainespin.com/RF2A5068A86',
    'coopers365.com': 'https://coopers365.com/RF19112637A',
    'crayspin.com': 'https://crayspin.com/RF2525973A1',
    'crown155au.com': 'https://crown155au.com/#autoRegister/10801/RFSPEED8LIVE',
    'crownspin96.com': 'https://crownspin96.com/RF2616092A1',
    'diamondaud.site': 'https://diamondaud.site/RF20367A935',
    'dollar33au.com': 'https://dollar33au.com/RF19A10A308',
    'double9.org': 'https://double9.org/RF2A5065167',
    'efa99aus.com': 'https://efa99aus.com/RF191139211',
    'emerald777.com': 'https://emerald777.com/RF280952516',
    'enjoy96.com': 'https://enjoy96.com/RF190387A58',
    'ezspin68.vip': 'https://ezspin68.vip/RF261611920',
    'finaplay.com': 'https://finaplay.com/RF210355020',
    'fun88aus.com': 'https://fun88aus.com/RF2503832',
    'funplay.vip': 'https://funplay.vip/RF2130A7619',
    'galaxys77.com': 'https://galaxys77.com/RF208150551',
    'game4u.games': 'https://game4u.games/RF2531530',
    'gday9au.com': 'https://gday9au.com/RF203672A63',
    'gemvault777.com': 'https://gemvault777.com/RF239122382',
    'glbet9.com': 'https://glbet9.com/RF225733520',
    'god88aus.com': 'https://god88aus.com/RF21A931960',
    'gopokies.co': 'https://gopokies.co/RF8893053',
    'happyaud668.co': 'https://happyaud668.co/RF291577669',
    'harbour33.com': 'https://harbour33.com/RF208A815A6',
    'hero-99.com': 'https://hero-99.com/RF28A829162',
    'hollywoodaus.com': 'https://hollywoodaus.com/RF22912991A',
    'icefrog777.com': 'https://icefrog777.com/RF251580671',
    'ipay9.net': 'https://ipay9.net/RF190822960',
    'ipay9aud.com': 'https://ipay9aud.com/RF190822960',
    'ironman98.com': 'https://Ironman98.com/RF287125712',
    'justpokies9.com': 'https://justpokies9.com/RF228600203',
    'justwin9.com': 'https://justwin9.com/RF29065A206',
    'k18win.com': 'https://k18win.com/AU21290350370',
    'kangaspin.com': 'https://kangaspin.com/RF198356797',
    'kf777aus.com': 'https://kf777aus.com/RF285991195',
    'kimberley333.com': 'https://kimberley333.com/RF2A258A698',
    'kingsman369.co': 'https://kingsman369.co/RF20A096A99',
    'kittylucky.co': 'https://kittylucky.co/RF20722A788',
    'koala88.club': 'https://koala88.club/RF191273165',
    'koala88.co': 'https://koala88.co/RF191273165',
    'kuromiau.com': 'https://kuromiau.com/RF22318A110',
    'lion88.website': 'https://lion88.website/RF2A2296913',
    'live77bet.com': 'https://live77bet.com/RF189515312',
    'luck77au.com': 'https://luck77au.com/RF25A920889',
    'lucky76au.com': 'https://lucky76au.com/RF192560995',
    'luxe66.com': 'https://luxe66.com/RF3628331',
    'm99au.com': 'https://m99au.com/RF189A97796',
    'm9aus.com': 'https://m9aus.com/RF22582177A',
    'marvelaus1.com': 'https://marvelaus1.com/RF2255A9A66',
    'me99au.com': 'https://me99au.com/RF19039A725',
    'methking.com': 'https://methking.com/RF2A9A65115',
    'mkaus.co': 'https://mkaus.co/RF3876A80',
    'mrbet9au.co': 'https://mrbet9au.co/RF19112762A',
    'mrlucky9.com': 'https://mrlucky9.com/RF2616202A9',
    'mrpokies9.com': 'https://mrpokies9.com/RF225757066',
    'mrspin9au.com': 'https://mrspin9au.com/RF23882160A',
    'mrvictor9.com': 'https://mrvictor9.com/RF261619119',
    'neiro55.com': 'https://neiro55.com/RF25705AA95',
    'nextpokies.com': 'https://nextpokies.com/RF257A12A56',
    'nicemeth.com': 'https://nicemeth.com/RF2A5067550',
    'nightclubaus.com': 'https://nightclubaus.com/RF192216993',
    'ocean96.com': 'https://ocean96.com/OCEAN96201A100A5',
    'okwin33.com': 'https://okwin33.com/RF236760602',
    'onewin9.com': 'https://onewin9.com/OW9290357053',
    'opera777a.info': 'https://opera777a.info/RF206786A59',
    'oz2win.com': 'https://oz2win.com/RF1891860A7',
    'ozreel88.com': 'https://ozreel88.com/RF2A3325071',
    'panda95au.com': 'https://panda95au.com/RF21A90365A',
    'play369.co': 'https://play369.co/RF200220120',
    'play369a.com': 'https://play369a.com/RF200220120',
    'play99au.com': 'https://play99au.com/RF182733583',
    'playaud.info': 'https://playaud.info/RF2052525A1',
    'playmeth.com': 'https://playmeth.com/RF2312A5590',
    'pokies33au.com': 'https://pokies33au.com/RF195509155',
    'pokies4bet.com': 'https://pokies4bet.com/RF229130665',
    'pokiesking1.com': 'https://pokiesking1.com/RF203058A95',
    'pokiestt.org': 'https://pokiestt.org/RF189169085',
    'pokiesww.org': 'https://pokiesww.org/RF192181377',
    'pokieswwau.com': 'https://pokieswwau.com/RF192181377',
    'queen88aus.com': 'https://queen88aus.com/RF189565068',
    'queenau.com': 'https://queenau.com/RF226153817',
    'r35au.co': 'https://r35au.co/RF20708AA12',
    'race96.com': 'https://race96.com/RF227997679',
    'raptor77.com': 'https://raptor77.com/RF192113110',
    'rec99au.com': 'https://rec99au.com/RF188520037',
    'redspin88.net': 'https://redspin88.net/RS3073816',
    'reef33.co': 'https://reef33.co/RF226860637',
    'reef33.site': 'https://reef33.site/RF226860637',
    'reef33.vip': 'https://reef33.vip/RF226860637',
    'retro33.com': 'https://retro33.com/RF229127781',
    'riches88.live': 'https://riches88.live/RF231280717',
    'richman96.com': 'https://richman96.com/RF192210181',
    'richpokies.com': 'https://richpokies.com/RF260528597',
    'richspinau.com': 'https://richspinau.com/RF28A082230',
    'rockgold33.com': 'https://rockgold33.com/RF23807367A',
    'rolex66.vip': 'https://rolex66.vip/RF189563A75',
    'royalaceau.com': 'https://royalaceau.com/RF257869A1A',
    'rtd33.com': 'https://rtd33.com/RF287130989',
    'scr66.com': 'https://scr66.com/RF189613633',
    'scr66.net': 'https://scr66.net/RF189613633',
    'silverfox1.co': 'https://silverfox1.co/RF28A6A7055',
    'skycrown33.com': 'https://skycrown33.com/RF190878222',
    'slotmeth.com': 'https://slotmeth.com/RF2A5068015',
    'spin96.com': 'https://spin96.com/RF187A56A99',
    'spinaud.club': 'https://spinaud.club/RF18799AA35',
    'spinaud.com': 'https://spinaud.com/RF18799AA35',
    'spinbizzo.com': 'https://spinbizzo.com/RF23A039A95',
    'spincash88.cash': 'https://spincash88.cash/RF229128876',
    'spincrown.online': 'https://spincrown.online/RF226859756',
    'spincrown33.com': 'https://spincrown33.com/RF226859756',
    'spindeluxe777.com': 'https://spindeluxe777.com/RF22A029683',
    'spinfortune777.com': 'https://spinfortune777.com/RF227A93301',
    'spinking.co': 'https://spinking.co/RF238769A60',
    'spinup77.com': 'https://spinup77.com/RF2335A1A08',
    'spinvegas9.com': 'https://spinvegas9.com/RF2351A8A88',
    'spinwoo.com': 'https://spinwoo.com/RF226199811',
    'ssv96.com': 'https://ssv96.com/RF200892909',
    'ssv96.net': 'https://ssv96.net/RF200892909',
    'steadyau.com': 'https://steadyau.com/RF266365579',
    'super996.com': 'https://super996.com/RF1903807A5',
    'supreme777.com': 'https://supreme777.com/RF261620702',
    'supremepokies.com': 'https://supremepokies.com/RF28792279A',
    'tab968.co': 'https://tab968.co/RF6289207',
    'tab968.com': 'https://tab968.com/RF6289207',
    'tab9au.com': 'https://tab9au.com/RF3922705',
    'tcl99.com': 'https://tcl99.com/RF20139826A',
    'theoneau.com': 'https://theoneau.com/RF2AA005182',
    'thepokies33.com': 'https://thepokies33.com/RF227992963',
    'thepokies96.com': 'https://thepokies96.com/RF210922381',
    'thestar.asia': 'https://thestar.asia/RF226155936',
    'tiger88.games': 'https://tiger88.games/RF220626AA2',
    'top1au.com': 'https://top1au.com/RF19221A612',
    'topaz33.com': 'https://topaz33.com/RF221929602',
    'topspin.one': 'https://topspin.one/RF2130A7305',
    'traviswin.com': 'https://traviswin.com/RF287913119',
    'truewin77.com': 'https://truewin77.com/RF261618096',
    'ubet96.com': 'https://ubet96.com/RF189503367',
    'ufc66.me': 'https://ufc66.me/RF25A6A601A',
    'unipokies.com': 'https://unipokies.com/RF28791225A',
    'unitedau.com': 'https://unitedau.com/RF210191815',
    'uwin33au.com': 'https://uwin33au.com/RF22A098138',
    'v12betau.net': 'https://v12betau.net/RF189522582',
    'vip777au.com': 'https://vip777au.com/RF250978957',
    'vip99.com': 'https://vip99.com/RF2106357',
    'vip99au.com': 'https://vip99au.com/RF2106357',
    'vspin365.com': 'https://vspin365.com/RF2616092A1',
    'w33aus.com': 'https://w33aus.com/RF191869869',
    'weplay88.co': 'https://weplay88.co/RF192138057',
    'weplay88.com': 'https://weplay88.com/RF192138057',
    'wildngo.net': 'https://wildngo.net/RF2A57A553A',
    'wildpokies1.com': 'https://wildpokies1.com/RF1917573A8',
    'wildspin24.com': 'https://wildspin24.com/RF258739277',
    'win29.club': 'https://win29.club/RF2522975',
    'win99aud.com': 'https://win99aud.com/RF207381169',
    'winwin9.org': 'https://winwin9.org/RF255253355',
    'winx96.com': 'https://winx96.com/RF21092A910',
    'won96.com': 'https://won96.com/LUCKYNUM2257313A7',
    'world99aud.com': 'https://world99aud.com/RF227905605',
    'wowspeed.club': 'https://wowspeed.club/RF291610A62',
    'aud33.online': 'https://aud33.online/TW1903653A3',
    'betjason.com': 'https://betjason.com/RF256857695',
    'go33au.com': 'https://go33au.com/RF2002266AA',
    'heroinspin.com': 'https://heroinspin.com/RF23A0A372A',
    'methspin.org': 'https://methspin.org/RF228757570',
    'raabet9.net': 'https://raabet9.net/RF2050AA113',
    'v12bet.net': 'https://v12bet.net/RF189522582',
    'zebra88.club': 'https://zebra88.club/RF2585A0289',
    'zeroaud.com': 'https://zeroaud.com/RF255979666',
    'zircon33.com': 'https://zircon33.com/RF221703766',
    'freeslot.cloud': 'https://freeslot.cloud/RF9298856',
    'mrbean9.com': 'https://mrbean9.com/RF25869A089'
  };

  const redirectURL = referralMap[ref] || 'https://payidcasinos.netlify.app';

  const sheetWebhook = "https://script.google.com/macros/s/AKfycbwtjbRijK44xIEnQSU2eGoC5eq-_8HYDuENhYH48BO39RN75Zas77j84SMlkss3eKwu/exec";

  try {
    const response = await fetch(sheetWebhook, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ ref, ip, userAgent, timestamp }),
    });

    const resultText = await response.text();
    console.log("✅ Sent to Google Sheet:", resultText);
  } catch (err) {
    console.error("❌ Failed to log to Google Sheet:", err);
  }

  return {
    statusCode: 302,
    headers: {
      Location: redirectURL,
    },
  };
};
